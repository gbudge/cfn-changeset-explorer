AWSTemplateFormatVersion: '2010-09-09'
Description: Network ACL nested stack â€” creates a NACL with rules associated to the provided VPC

Parameters:
  VpcId:
    Type: AWS::EC2::VPC::Id
    Description: VPC to associate the NACL with

Resources:
  PublicNACL:
    Type: AWS::EC2::NetworkAcl
    Properties:
      VpcId: !Ref VpcId
      Tags:
        - Key: Name
          Value: !Sub "${AWS::StackName}-nacl"

  AllowHTTPIngress:
    Type: AWS::EC2::NetworkAclEntry
    Properties:
      NetworkAclId: !Ref PublicNACL
      RuleNumber: 100
      Protocol: 6
      RuleAction: allow
      Egress: false
      CidrBlock: 0.0.0.0/0
      PortRange:
        From: 80
        To: 80

  AllowHTTPSIngress:
    Type: AWS::EC2::NetworkAclEntry
    Properties:
      NetworkAclId: !Ref PublicNACL
      RuleNumber: 110
      Protocol: 6
      RuleAction: allow
      Egress: false
      CidrBlock: 0.0.0.0/0
      PortRange:
        From: 443
        To: 443

Outputs:
  NaclId:
    Description: ID of created NACL
    Value: !Ref PublicNACL